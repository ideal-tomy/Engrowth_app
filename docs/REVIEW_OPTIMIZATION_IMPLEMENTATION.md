# 復習最適化（忘却曲線/ヒント使用率）導入手順

## 目的
学習効率を最大化するため、忘却曲線に基づく復習タイミングと、ヒント使用率を加味した再提示ロジックを導入する。

## 対象機能
- 復習リスト自動生成
- ヒント使用率ベースの優先度付け
- 1日の復習枠（今日の復習）

## UI/UX要件（スマホ前提）
- 学習タブの上部に「今日の復習」カード
- 進捗画面に「要復習」セクションを追加
- 復習セッションは通常学習と同じUI/導線で開始

## 技術要件
### 1) データモデル拡張
`user_progress`へ復習用のフィールドを追加
- `last_review_at` (timestamptz)
- `next_review_at` (timestamptz)
- `stability` (float)  // 記憶安定度
- `difficulty` (float) // 難易度
- `review_count` (int)

### 2) 復習優先度ロジック
基本スコアを算出して並び順を決める:
```
priority = base
base += (now > next_review_at) ? 3 : 0
base += (hint_usage_count >= 2) ? 2 : 0
base += (used_hint_to_master) ? 1 : 0
base += (average_thinking_time > threshold) ? 1 : 0
```

### 3) 復習間隔の算出
簡易SR (Spaced Repetition) ルール:
- 正解 & ヒントなし → 次回 +3日
- 正解 & ヒントあり → 次回 +1日
- 不正解 → 次回 +6時間
※将来SM-2に移行可能な設計にする

## 実装手順
1. **DBスキーマ更新**
   - `user_progress`へ復習系フィールド追加
2. **モデル更新**
   - `UserProgress`に新規フィールド追加
3. **復習キュー生成ロジック**
   - `next_review_at`が過去のものを優先取得
   - `priority`計算で並び替え
4. **復習セッション導線**
   - 学習タブに「今日の復習」CTA
5. **ログ更新**
   - 学習完了時に`last_review_at`/`next_review_at`更新
6. **進捗画面表示**
   - 「要復習」件数/カテゴリを表示

## 画面設計（簡易ワイヤー）
```
┌──────────────┐
│ 今日の復習 5件 │
│ [復習を開始]   │
└──────────────┘
```

## 受け入れ条件
- `next_review_at`が過去のものを正しく抽出できる
- ヒント使用率が復習優先度に反映される
- 復習セッションが通常学習と同じUIで開始できる

