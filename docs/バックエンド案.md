# 英会話コンサルティング支援アプリ 構想まとめ

> **更新履歴**: submission_type（提出/練習）の分離、ユーザーUIの心理的ハードル配慮、コンサルタントダッシュボードのメイン/履歴ビュー、提出されない場合の見える化、LINE先行実装（LINE WORKSは契約後）を反映

## 1. コンセプト

**「テクノロジーで人間の伴走力を最大化する」**

アプリ単体での完結を目指さず、日本人コンサルタントによる「徹底したパーソナライズ指導」を裏側から支えるインフラとして機能させる。

### 前提: 隙間時間を活かす伴走型コンサルタント契約

- **ユーザー（クライアント）**: 通勤中・昼休み・就寝前などの隙間時間で学習
- **コンサルタント（講師）**: 空いた時間に音声確認・アドバイスを届ける
- **非同期設計**: 相手の都合を待たず、各自のペースでやり取りできる仕組み

---

## 2. ユーザー体験（UI/UX）

### ① オンボーディング
- **属性・悩み診断**: 学習目的、過去の挫折経験、苦手分野（リスニング、発音等）をヒアリング
- **AIカリキュラム提示**: 回答を元にAIが個別の学習指針を生成。「自分専用」であることを演出

### ② アカウント管理（シームレスな登録）
- **匿名ログイン**: 初回起動時は登録不要で即学習開始
- **1タップ昇格**: 録音データや履歴を保存する段階で Google/LINE 連携へ誘導
- **機種変時のデータ保持**と信頼性を確保

### ③ 学習・アウトプット
- **隙間時間特化**: 1回数分の学習（瞬間英作文、単語、会話シナリオ等）
- **音声録音機能**: すべてのアウトプットを保存し、**コンサルタントが確認・レビュー可能に**
- **成長のポートフォリオ**: 過去の自分と比較できる

---

## 3. 音声録音 → コンサルタントレビュー機能（拡張）

### 現状と課題
- 現在: 録音は**ローカルのみ**で学習終了時に削除
- 課題: コンサルタントが音声を聞いてアドバイスできない

### 3.1 録音データのステータス管理（submission_type）

**すべての音声は自動でストレージに保存**しますが、DB側で以下の2種類のステータスを切り分けます。

| submission_type | ユーザーの認識 | コンサルタントの活用方法 |
|-----------------|----------------|--------------------------|
| **submitted（提出）** | 「納得のいくデキ。先生、聞いて！」 | 最優先で添削・返信を行う対象。成長の証として評価する。**提出時のみLINE通知が飛ぶ** |
| **practice（練習）** | 「これはボツ。自分用の練習」 | 「なぜ詰まったか」を分析する材料。直接の添削はせず、**面談時のアドバイスの根拠**にする |

- **通知のタイミング**: ユーザーが「提出」を選択したときのみ、コンサルタントへLINE通知
- **録音は常に行う**: 練習も含めすべてストレージに保存し、コンサルタントが必要に応じて参照可能に

### 3.2 ユーザー側UI：心理的ハードルを下げる工夫

「常に録音されている」という圧迫感を与えず、かつ「保存」へ誘導する導線です。

| 要素 | 設計 |
|------|------|
| **録音中表示** | 画面の隅で波形が動いている程度にし、「常に録音しています」とはあえて強調しない |
| **利用規約・初期説明** | 「学習効率向上のためすべての音声は記録されます」と同意を得る |
| **「保存」ボタン** | 学習終了後、「今回の会心の1回を先生に送る」ボタンを用意。これを押すと `submission_type = 'submitted'` となり、講師にLINE通知が飛ぶ |
| **セルフチェック** | 提出前に自分の音声を聴き直せる。「納得いくまで何度でもどうぞ」と促し、自然と練習回数を増やす |

### 3.3 提出されない場合の見える化（伴走の質向上）

ユーザーが長期間「提出」していないとき、コンサルタントが以下を把握できるようにする。

| 想定パターン | 判別の手がかり | 伴走のヒント |
|-------------|----------------|-------------|
| 提出していないだけ | 練習音声が多く保存されている | 「いつでも送ってくださいね」と一声かける |
| そもそも学習していない | 練習音声も少ない、学習ログが空 | リマインドや学習習慣の相談 |
| 納得いく発音ができていない | 練習回数は多いが提出がゼロ | 該当シナリオの難易度調整や、発音のコツを事前に伝える |

**ダッシュボードでの表示例**:
- 「練習○回・提出○回」（直近7日/30日）
- 「最後の提出から○日経過」
- 練習音声の件数トレンド

### 3.4 拡張設計のフロー

| ステップ | ユーザー側 | システム側 |
|----------|------------|------------|
| 1 | 学習中に録音（発話・会話の読み上げ等） | **すべての録音を自動で Supabase Storage へ保存**（`submission_type = 'practice'`） |
| 2 | セルフチェックで聴き直し、納得したら「先生に送る」ボタンをタップ | `submission_type = 'submitted'` に更新 |
| 3 | - | 担当コンサルタントへ **LINE 通知** |
| 4 | アプリ内で「アドバイス待ち」状態を確認 | - |
| 5 | - | コンサルタントが音声を聴き、フィードバック入力 |
| 6 | アプリ内で通知を受け取り、フィードバックを確認 | 通知をプッシュ or アプリ内表示 |

### 3.5 データモデル（修正版）

```sql
-- 音声提出テーブル（コンサルタント添削用）
CREATE TABLE voice_submissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  conversation_id UUID REFERENCES conversations(id) ON DELETE SET NULL,
  utterance_id UUID REFERENCES conversation_utterances(id) ON DELETE SET NULL,
  audio_url TEXT NOT NULL,              -- Supabase Storage の URL
  session_id TEXT,                     -- 学習セッション識別
  submission_type TEXT DEFAULT 'practice',  -- 'submitted' (提出) か 'practice' (練習)
  review_status TEXT DEFAULT 'pending',    -- pending / reviewed（提出されたもののみ意味あり）
  consultant_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  reviewed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 講師用ダッシュボードでの取得イメージ
-- 提出されたものだけをまずリストアップ
SELECT * FROM voice_submissions
WHERE user_id = '生徒ID' AND submission_type = 'submitted'
ORDER BY created_at DESC;

-- その提出に紐付く「ボツ練習」を特定（同一セッション内の practice を取得）
SELECT * FROM voice_submissions
WHERE session_id = '該当セッションID' AND submission_type = 'practice'
ORDER BY created_at ASC;

-- コンサルタントのフィードバックテーブル
CREATE TABLE voice_feedbacks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  voice_submission_id UUID REFERENCES voice_submissions(id) ON DELETE CASCADE,
  client_message TEXT NOT NULL,   -- クライアント向け（励まし・具体的な添削）
  internal_note TEXT,             -- 社内管理用（専門的メモ）
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 3.6 隙間時間を活かす設計のポイント

- **一括提出**: 複数の録音をまとめて「先生に送る」できる
- **優先度**: ユーザーが「ここを重点的に見てほしい」とマーク可能
- **所要時間の目安**: コンサルタントに「所要時間 約○分」を表示し、空き時間に取り組みやすくする

---

## 4. コンサルタント用ダッシュボード（バックエンド）

講師が隙間時間で効率的に、かつ深くクライアントを把握するための管理画面。

### ① 学習文脈の可視化
- **時間帯・継続時間の把握**: 「いつ、何分やったか」をヒアリングの材料に
- **学習状況ヒートマップ**: クライアントの生活リズム（朝型・夜型等）を把握し、最適な学習時間を提案
- **提出されない場合の見える化**: 練習○回・提出○回、最後の提出から○日経過（セクション3.3参照）

### ② 音声添削・フィードバック

| 項目 | 内容 |
|------|------|
| **累積音声データ** | 過去と現在の音声を並べて再生し、微細な発音の変化を確認 |
| **二段階フィードバック** | **クライアント向け**: アプリへ通知される励まし・添削 |
| | **社内管理用ログ**: 会社側が業務品質を把握するための専門的メモ |

### ③ 分析の効率化：メインビューと履歴ビュー

講師がすべての音声をダラダラ聴くのは非効率なので、画面上で視覚的に分けます。

| ビュー | 表示内容 | 用途 |
|--------|----------|------|
| **メインビュー** | **「提出済み」の音声**が大きく表示され、即座にフィードバックを入力できる | 最優先で添削・返信 |
| **履歴ビュー（タイムライン）** | 提出された音声の**手前**にある複数の練習音声を、小さなアイコンや波形で表示 | 講師が「提出分」を聞いて違和感を持った時だけ、その前の「ボツ音声」を確認。「あ、ここで何度も言い直しているから、この文法がまだ定着していないんだな」と裏付けを取る |

### ④ その他の効率化UI（隙間時間対応）

- **未対応一覧**: 未レビューの**提出分のみ**を一覧表示、**所要時間の目安**付き
- **スキップ・後回し**: 空き時間が少ないときは「後で」に回せる
- **テンプレート**: よく使うフィードバックを定型文で挿入
- **音声の倍速再生**: 効率的に確認

---

## 5. 通知・連携システム

### ① LINE 連携（初期実装・機能確認用）※優先

LINE WORKS は事前契約が必要なため、**まずは LINE で実装し機能確認**を行う。

| トリガー | 通知先 | 内容例 |
|----------|--------|--------|
| **音声提出**（submission_type = 'submitted' のときのみ） | 担当コンサルタント | 「○さんから添削依頼が届きました（約3分）」+ 添削画面URL |
| フィードバック完了 | ユーザー | 「アドバイスが届きました」+ アプリ内フィードバック画面URL |
| 学習完了（オプション） | 担当コンサルタント | 「○さんが本日○分学習しました」 |

**URL設計**:
- 添削画面: `https://app.example.com/consultant/review/{submission_id}`
- フィードバック確認: アプリのディープリンク `engrowth://feedback/{feedback_id}`

**技術**: LINE Messaging API、または LINE Login 連携 + プッシュ通知

### ② LINE WORKS 連携（法人導入時）

- B2B・法人向けには LINE WORKS を検討
- **事前契約が必要**なため、LINE で動作確認後に移行

### ③ 後から確認するための環境

- **通知履歴**: どのタイミングで何が通知されたかログ保持
- **未読管理**: コンサルタント・ユーザーそれぞれの「未確認」状態を管理
- **リマインダー**: 長時間未対応の場合、コンサルタントへリマインド通知（オプション）

---

## 6. システム構成案

Supabase を主軸とした、スケーラビリティと低コストを両立する構成。

| コンポーネント | 技術スタック | 役割 |
|----------------|-------------|------|
| フロントエンド | Flutter | iOS / Android / Web（管理画面）のマルチプラットフォーム対応 |
| 認証・DB | Supabase | 匿名ログイン、5万人までの無料枠、リアルタイムDB機能 |
| ストレージ | Supabase Storage | 音声ファイル（1GBまで無料）の保存とURL管理 |
| ロジック・通知 | Edge Functions | 音声提出・フィードバック完了をトリガーに **LINE API** へ通知（初期）。LINE WORKS は契約後に移行 |
| AIエンジン | Gemini API | アンケート解析、学習プランの自動生成 |

---

## 7. ユーザー・コンサルタント両方の効率化考察

### ユーザー側

| 課題 | 対策 |
|------|------|
| いつ学習したらいいかわからない | ヒートマップから「自分に合う時間帯」を提案 |
| フィードバックを待つ間、やることがない | 待ち時間中も別の学習コンテンツをすすめられる導線 |
| 録音が恥ずかしい | 「自分だけ」「担当講師だけ」に見られる安心感の訴求 |
| フィードバックが抽象的 | テンプレート＋具体的な表現例で「次にどうすればいいか」を明確に |

### コンサルタント側

| 課題 | 対策 |
|------|------|
| 添削にどのくらい時間がかかるか不明 | 音声長・件数から「約○分」を表示 |
| 隙間時間がバラバラ | 未対応を優先度・所要時間でソートし、空き時間に合わせて選べる |
| 同じアドバイスを繰り返し書く | 定型文テンプレート、コピペで使えるフレーズ集 |
| クライアントの成長が把握しづらい | 過去音声との比較再生、成長トレンドの可視化 |

---

## 8. 本アプリのビジネス的価値

- **ブランディング**: 「日本人の弱点を知り尽くしたプロが、最新のデータを使って伴走する」という独自性の確立
- **LTV（顧客生涯価値）の向上**: 講師の「クイックな声がけ」により、ユーザーが「自分を見てくれている」と実感し、継続率が向上
- **社内資産の蓄積**: コンサルタントのアドバイス内容をデータ化し、指導の型（ナレッジ）として会社に蓄積

---

## 9. 実装フェーズ案

### Phase 1（MVP）: 録音のクラウド保存とステータス管理 ✅

- [x] 録音ファイルを**すべて自動で** Supabase Storage へアップロード（`submission_type = 'practice'`）
- [x] `voice_submissions` テーブル作成（`submission_type`, `review_status` 含む）
- [x] ユーザーUI：「先生に送る」ボタン（`submission_type = 'submitted'` に更新）、セルフチェック（聴き直す）
- [x] 録音中表示：波形表示（圧迫感を与えない）
- [x] 利用規約・初期説明での録音同意
- [x] コンサルタント用Web画面（**提出分のみ**メインビュー、`/consultant`）

### Phase 2: LINE 通知連携

- [ ] **LINE** 連携（Edge Function + LINE Messaging API）
- [ ] 提出時（`submission_type = 'submitted'` のときのみ）・フィードバック完了時の通知
- [ ] 通知履歴・未読管理
- [ ] ※LINE WORKS は契約後に移行

### Phase 3: 提出されない場合の見える化・効率化

- [ ] コンサルタント向け「練習○回・提出○回」「最後の提出から○日経過」
- [ ] 学習ヒートマップ
- [ ] 過去音声との比較再生
- [ ] フィードバックテンプレート
- [ ] 所要時間の目安表示

### Phase 4（将来）: LINE WORKS 移行

- [ ] LINE WORKS 契約後、法人向けに移行
